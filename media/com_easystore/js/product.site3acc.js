document.addEventListener('alpine:init',()=>{Alpine.data('easystore_product_review',initialData=>({data:{title:'',ratings:'',message:'',requiredValues:['title','ratings'],},submitReview(){const isValid=this.data.requiredValues.every(field=>`${this.data[field]}`.trim());if(!isValid)return;const formData=new FormData();formData.append('easystore-title',this.data.title);formData.append('easystore-ratings',this.data.ratings);formData.append('easystore-message',this.data.message);formData.append('productId',initialData.productId);const url=`${Joomla.getOptions('easystore.base')}/index.php?option=com_easystore&task=product.addReview`;Joomla.request({url,method:'POST',data:formData,onSuccess:response=>{response=JSON.parse(response);if(response.status==='success'){document.location.reload();}},onError:xhr=>{Joomla.renderMessages(Joomla.ajaxErrorsMessages(xhr));},});},}));Alpine.directive('log',(el,{expression},{evaluate})=>{console.log(evaluate(expression));});Alpine.data('easystore_invoice',()=>({easystorePrintInvoice(){window.print();},}));});document.addEventListener('alpine:init',()=>{Alpine.data('easystoreProductDetails',()=>{return{quantity:1,loading:false,onThumbnailChange(event,src){if(this.$refs.productThumbnail){this.$refs.productThumbnail.src=src;const parent=event.currentTarget.parentNode;const buttons=parent.querySelectorAll('button');buttons.forEach(button=>button.classList.remove('active'));event.currentTarget.classList.add('active');}},increment(){this.quantity=Number(this.quantity)+1;},decrement(){this.quantity=Math.max(1,Number(this.quantity)-1);},closeOpenedModalIfAny(){const modal=document.querySelector('#easystore-modal');modal.classList.remove('active');modal.setAttribute('aria-hidden','true');modal.setAttribute('aria-busy','false');document.body.classList.remove('easystore-modal-open');},addToCart(productId,skuId){const formData=new FormData();const items=[{product_id:productId,sku_id:skuId||null,quantity:this.quantity,},];const url=`${Joomla.getOptions('easystore.base')}/index.php?option=com_easystore&task=cart.addToCart`;formData.append('items',JSON.stringify(items));formData.append('initiator','cart-button');formData.append('_method','POST');this.loading=true;Joomla.request({url,method:'POST',data:formData,onSuccess:()=>{this.loading=false;this.errorMessage='';this.closeOpenedModalIfAny();this.$dispatch('drawer.open');},onError:error=>{this.loading=false;const response=error.response&&JSON.parse(error.response);this.errorMessage=response?.data?.message??'';alert(this.errorMessage);},});},async openQuickAddModal(id){this.loading=true;const wrapper=document.querySelector('#easystore-modal');wrapper.classList.add('active');wrapper.setAttribute('aria-busy','true');const response=await fetch(`${Joomla.getOptions('easystore.base')}/index.php?option=com_easystore&task=product.quickAddModal&id=${id}`);const data=await response.json();const content=wrapper.querySelector('.modal-content');content.innerHTML=data.data;wrapper.setAttribute('aria-busy','false');wrapper.setAttribute('aria-hidden','false');document.body.classList.add('easystore-modal-open');this.loading=false;},getVariant(combination,productId){const refname=`product_variants_${productId}`;const variants=JSON.parse(this.$refs[refname].value);if(variants.length===0||!combination){return null;}
return(variants.find(variant=>variant.combination.toLowerCase()===combination.toLowerCase())??false);},generateCombination(options){if(!Array.isArray(options)){return;}
options.sort();return options.join(';');},getCheckedRadios(productId){const refname=`option_wrapper_${productId}`;if(!!this.$refs?.[refname]){const checkedRadios=[...this.$refs[refname].querySelectorAll('input[type=radio]:checked')];if(checkedRadios.length===0){return[];}
this.checkedOptions=checkedRadios.reduce((result,current)=>{result[current.name]=current.value;return result;},{});return checkedRadios.map(element=>element.value);}},async handleRadioChange(origin,productId){const activeVariant=this.getVariant(this.generateCombination(this.getCheckedRadios(productId)),productId);const search=new URLSearchParams(window.location.search);if(origin==='single'){search.set('variant',activeVariant.id);window.history.replaceState(null,'',`${window.location.pathname}?${search.toString()}`);}
const section=origin==='single'?'page-content':'quick-modal';await this.fetchProductContentByVariants(activeVariant.product_id,activeVariant.id,section);Joomla.applyImageLazyLoading();},async fetchProductContentByVariants(productId,variantId,section){const url=`${Joomla.getOptions('easystore.base')}/index.php?option=com_easystore&task=product.contentByVariant&product_id=${productId}&variant_id=${variantId}&section_id=${section}`;const response=await fetch(url);const data=await response.json();const sectionElement=document.querySelector(data.data.section);sectionElement.innerHTML=data.data.content;},};});});